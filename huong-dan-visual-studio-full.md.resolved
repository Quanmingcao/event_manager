# H∆∞·ªõng d·∫´n Visual Studio 2022: X√¢y d·ª±ng Backend ASP.NET Core

> [!IMPORTANT]
> H∆∞·ªõng d·∫´n n√†y ƒë∆∞·ª£c thi·∫øt k·∫ø cho **Visual Studio 2022** (m√†u t√≠m), v·ªõi c√°c b∆∞·ªõc th·ª±c hi·ªán tr·ª±c quan qua giao di·ªán. Backend s·∫Ω k·∫øt n·ªëi v·ªõi Supabase PostgreSQL database hi·ªán c√≥ c·ªßa b·∫°n.

---

## üìã T·ªïng quan c·∫•u tr√∫c d·ª± √°n

```
üìÅ EventManager (Solution)
‚îú‚îÄ‚îÄ üìÅ EventManager.API                    ‚Üê Web API Project (Controllers, Program.cs)
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ Controllers                     ‚Üê API Endpoints
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ Hubs                           ‚Üê SignalR Hubs
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ appsettings.json               ‚Üê C·∫•u h√¨nh (Connection String, JWT)
‚îÇ   ‚îî‚îÄ‚îÄ üìÑ Program.cs                     ‚Üê Entry point, DI configuration
‚îÇ
‚îú‚îÄ‚îÄ üìÅ EventManager.Application            ‚Üê Business Logic Layer
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ DTOs                           ‚Üê Data Transfer Objects
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÅ Auth                       ‚Üê Login/Register DTOs
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ Services                       ‚Üê Business Services
‚îÇ
‚îú‚îÄ‚îÄ üìÅ EventManager.Domain                 ‚Üê Domain Entities
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ Entities                       ‚Üê Database Models (Event, Staff, etc.)
‚îÇ
‚îî‚îÄ‚îÄ üìÅ EventManager.Infrastructure         ‚Üê Data Access Layer
    ‚îú‚îÄ‚îÄ üìÅ Data                           ‚Üê DbContext
    ‚îî‚îÄ‚îÄ üìÅ Services                       ‚Üê JWT Service, File Upload
```

---

## PH·∫¶N 1: T·∫†O SOLUTION V√Ä C·∫§U TR√öC D·ª∞ √ÅN

### B∆∞·ªõc 1.1: T·∫°o Project ƒë·∫ßu ti√™n

1. M·ªü **Visual Studio 2022**
2. Click **"Create a new project"**
3. T√¨m ki·∫øm: `ASP.NET Core Web API`
4. Ch·ªçn template **ASP.NET Core Web API** (C#)
5. Click **Next**

**C·∫•u h√¨nh:**
```
Project name: EventManager.API
Location: C:\Users\User\Desktop\EventManagerBackend
Solution name: EventManager
‚òë Place solution and project in the same directory
```

6. Click **Next**

**Framework settings:**
```
Framework: .NET 8.0 (Long Term Support)
Authentication type: None
‚òë Configure for HTTPS
‚òë Enable OpenAPI support
‚òë Use controllers
‚òê Enable Docker
```

7. Click **Create**

### B∆∞·ªõc 1.2: Th√™m Class Library Projects

**T·∫°o EventManager.Domain:**
1. Right-click Solution `EventManager` trong **Solution Explorer**
2. **Add ‚Üí New Project**
3. T√¨m: `Class Library`
4. Ch·ªçn **Class Library** (C#)
5. T√™n: `EventManager.Domain`
6. Framework: **.NET 8.0**
7. Click **Create**
8. **X√≥a file `Class1.cs`** (right-click ‚Üí Delete)

**T·∫°o EventManager.Application:**
- L·∫∑p l·∫°i c√°c b∆∞·ªõc tr√™n v·ªõi t√™n `EventManager.Application`
- X√≥a `Class1.cs`

**T·∫°o EventManager.Infrastructure:**
- L·∫∑p l·∫°i c√°c b∆∞·ªõc tr√™n v·ªõi t√™n `EventManager.Infrastructure`
- X√≥a `Class1.cs`

### B∆∞·ªõc 1.3: Thi·∫øt l·∫≠p Project References

**EventManager.API c·∫ßn reference:**
1. Right-click **EventManager.API** ‚Üí **Add ‚Üí Project Reference**
2. Check ‚òë **EventManager.Application**
3. Check ‚òë **EventManager.Infrastructure**
4. Click **OK**

**EventManager.Application c·∫ßn reference:**
1. Right-click **EventManager.Application** ‚Üí **Add ‚Üí Project Reference**
2. Check ‚òë **EventManager.Domain**
3. Click **OK**

**EventManager.Infrastructure c·∫ßn reference:**
1. Right-click **EventManager.Infrastructure** ‚Üí **Add ‚Üí Project Reference**
2. Check ‚òë **EventManager.Application**
3. Click **OK**

---

## PH·∫¶N 2: C√ÄI ƒê·∫∂T NUGET PACKAGES

### B∆∞·ªõc 2.1: Packages cho EventManager.API

1. Right-click **EventManager.API** ‚Üí **Manage NuGet Packages**
2. Click tab **Browse**
3. T√¨m v√† c√†i ƒë·∫∑t:

| Package | Version |
|---------|---------|
| `Microsoft.EntityFrameworkCore.Design` | 8.0.x |
| `Microsoft.AspNetCore.Authentication.JwtBearer` | 8.0.x |
| `Swashbuckle.AspNetCore` | 6.5.x (ƒë√£ c√≥ s·∫µn) |

### B∆∞·ªõc 2.2: Packages cho EventManager.Infrastructure

1. Right-click **EventManager.Infrastructure** ‚Üí **Manage NuGet Packages**
2. C√†i ƒë·∫∑t:

| Package | Version |
|---------|---------|
| `Npgsql.EntityFrameworkCore.PostgreSQL` | 8.0.x |
| `Microsoft.EntityFrameworkCore` | 8.0.x |
| `Microsoft.EntityFrameworkCore.Tools` | 8.0.x |

### B∆∞·ªõc 2.3: Packages cho EventManager.Application

1. Right-click **EventManager.Application** ‚Üí **Manage NuGet Packages**
2. C√†i ƒë·∫∑t:

| Package | Version |
|---------|---------|
| `FluentValidation` | 11.x |
| `AutoMapper` | 12.x |

> [!TIP]
> Sau khi c√†i xong, build solution: **Build ‚Üí Build Solution** (Ctrl+Shift+B)

---

## PH·∫¶N 3: T·∫†O DOMAIN ENTITIES

### B∆∞·ªõc 3.1: T·∫°o th∆∞ m·ª•c Entities

1. Right-click **EventManager.Domain**
2. **Add ‚Üí New Folder**
3. T√™n: `Entities`

### B∆∞·ªõc 3.2: T·∫°o 7 Entity Classes

#### üìÑ Event.cs

1. Right-click folder **Entities** ‚Üí **Add ‚Üí Class**
2. T√™n: `Event.cs`
3. Paste code:

```csharp
using System;
using System.Collections.Generic;

namespace EventManager.Domain.Entities
{
    public class Event
    {
        public Guid Id { get; set; }
        public string Name { get; set; } = string.Empty;
        public string? Organizer { get; set; }
        public DateTime? StartDate { get; set; }
        public string? Location { get; set; }
        public string? Format { get; set; }
        public string? ScriptLink { get; set; }
        public string? TimelineLink { get; set; }
        public string Status { get; set; } = "Planning";
        public string? OutcomeSummary { get; set; }
        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;

        public ICollection<EventTask> EventTasks { get; set; } = new List<EventTask>();
        public ICollection<EventFinance> EventFinances { get; set; } = new List<EventFinance>();
    }
}
```

#### üìÑ Staff.cs

```csharp
using System;
using System.Collections.Generic;

namespace EventManager.Domain.Entities
{
    public class Staff
    {
        public Guid Id { get; set; }
        public string FullName { get; set; } = string.Empty;
        public string? StaffType { get; set; }
        public string? Phone { get; set; }
        public string? Department { get; set; }

        public ICollection<EventTask> EventTasks { get; set; } = new List<EventTask>();
    }
}
```

#### üìÑ TaskTemplate.cs

```csharp
using System;
using System.Collections.Generic;

namespace EventManager.Domain.Entities
{
    public class TaskTemplate
    {
        public Guid Id { get; set; }
        public string TaskName { get; set; } = string.Empty;
        public string? Description { get; set; }

        public ICollection<EventTask> EventTasks { get; set; } = new List<EventTask>();
    }
}
```

#### üìÑ EventTask.cs

```csharp
using System;

namespace EventManager.Domain.Entities
{
    public class EventTask
    {
        public Guid Id { get; set; }
        public Guid EventId { get; set; }
        public Guid? TaskId { get; set; }
        public Guid? StaffId { get; set; }
        public string Status { get; set; } = "Pending";
        public string? Note { get; set; }

        public Event Event { get; set; } = null!;
        public TaskTemplate? Task { get; set; }
        public Staff? Staff { get; set; }
    }
}
```

#### üìÑ Service.cs

```csharp
using System;
using System.Collections.Generic;

namespace EventManager.Domain.Entities
{
    public class Service
    {
        public Guid Id { get; set; }
        public string ServiceName { get; set; } = string.Empty;
        public decimal BasePrice { get; set; } = 0;

        public ICollection<EventFinance> EventFinances { get; set; } = new List<EventFinance>();
    }
}
```

#### üìÑ EventFinance.cs

```csharp
using System;

namespace EventManager.Domain.Entities
{
    public class EventFinance
    {
        public Guid Id { get; set; }
        public Guid EventId { get; set; }
        public Guid? ServiceId { get; set; }
        public decimal EstimatedAmount { get; set; } = 0;
        public string? EstimatedNote { get; set; }
        public decimal ExtraAmount { get; set; } = 0;
        public string? ExtraNote { get; set; }
        public decimal TotalAmount => EstimatedAmount + ExtraAmount;

        public Event Event { get; set; } = null!;
        public Service? Service { get; set; }
    }
}
```

#### üìÑ Profile.cs

```csharp
using System;

namespace EventManager.Domain.Entities
{
    public class Profile
    {
        public Guid Id { get; set; }
        public string? Email { get; set; }
        public string? FullName { get; set; }
        public string Role { get; set; } = "staff";
        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    }
}
```

**K·∫øt qu·∫£:** Folder Entities s·∫Ω c√≥ 7 files

---

## PH·∫¶N 4: C·∫§U H√åNH DATABASE CONTEXT

### B∆∞·ªõc 4.1: T·∫°o th∆∞ m·ª•c Data

1. Right-click **EventManager.Infrastructure**
2. **Add ‚Üí New Folder**
3. T√™n: `Data`

### B∆∞·ªõc 4.2: T·∫°o ApplicationDbContext.cs

1. Right-click folder **Data** ‚Üí **Add ‚Üí Class**
2. T√™n: `ApplicationDbContext.cs`
3. Paste code (FILE D√ÄI):

```csharp
using Microsoft.EntityFrameworkCore;
using EventManager.Domain.Entities;

namespace EventManager.Infrastructure.Data
{
    public class ApplicationDbContext : DbContext
    {
        public ApplicationDbContext(DbContextOptions<ApplicationDbContext> options)
            : base(options)
        {
        }

        public DbSet<Event> Events { get; set; }
        public DbSet<Staff> Staff { get; set; }
        public DbSet<TaskTemplate> TaskTemplates { get; set; }
        public DbSet<EventTask> EventTasks { get; set; }
        public DbSet<Service> Services { get; set; }
        public DbSet<EventFinance> EventFinances { get; set; }
        public DbSet<Profile> Profiles { get; set; }

        protected override void OnModelCreating(ModelBuilder modelBuilder)
        {
            base.OnModelCreating(ModelBuilder);

            // Events
            modelBuilder.Entity<Event>(entity =>
            {
                entity.ToTable("events");
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Id).HasColumnName("id");
                entity.Property(e => e.Name).HasColumnName("name").IsRequired();
                entity.Property(e => e.Organizer).HasColumnName("organizer");
                entity.Property(e => e.StartDate).HasColumnName("start_date");
                entity.Property(e => e.Location).HasColumnName("location");
                entity.Property(e => e.Format).HasColumnName("format");
                entity.Property(e => e.ScriptLink).HasColumnName("script_link");
                entity.Property(e => e.TimelineLink).HasColumnName("timeline_link");
                entity.Property(e => e.Status).HasColumnName("status").HasDefaultValue("Planning");
                entity.Property(e => e.OutcomeSummary).HasColumnName("outcome_summary");
                entity.Property(e => e.CreatedAt).HasColumnName("created_at").HasDefaultValueSql("now()");
            });

            // Staff
            modelBuilder.Entity<Staff>(entity =>
            {
                entity.ToTable("staff");
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Id).HasColumnName("id");
                entity.Property(e => e.FullName).HasColumnName("full_name").IsRequired();
                entity.Property(e => e.StaffType).HasColumnName("staff_type");
                entity.Property(e => e.Phone).HasColumnName("phone");
                entity.Property(e => e.Department).HasColumnName("department");
            });

            // TaskTemplates
            modelBuilder.Entity<TaskTemplate>(entity =>
            {
                entity.ToTable("task_templates");
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Id).HasColumnName("id");
                entity.Property(e => e.TaskName).HasColumnName("task_name").IsRequired();
                entity.Property(e => e.Description).HasColumnName("description");
            });

            // EventTasks
            modelBuilder.Entity<EventTask>(entity =>
            {
                entity.ToTable("event_tasks");
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Id).HasColumnName("id");
                entity.Property(e => e.EventId).HasColumnName("event_id");
                entity.Property(e => e.TaskId).HasColumnName("task_id");
                entity.Property(e => e.StaffId).HasColumnName("staff_id");
                entity.Property(e => e.Status).HasColumnName("status").HasDefaultValue("Pending");
                entity.Property(e => e.Note).HasColumnName("note");

                entity.HasOne(e => e.Event)
                    .WithMany(e => e.EventTasks)
                    .HasForeignKey(e => e.EventId)
                    .OnDelete(DeleteBehavior.Cascade);

                entity.HasOne(e => e.Task)
                    .WithMany(t => t.EventTasks)
                    .HasForeignKey(e => e.TaskId)
                    .OnDelete(DeleteBehavior.SetNull);

                entity.HasOne(e => e.Staff)
                    .WithMany(s => s.EventTasks)
                    .HasForeignKey(e => e.StaffId)
                    .OnDelete(DeleteBehavior.SetNull);
            });

            // Services
            modelBuilder.Entity<Service>(entity =>
            {
                entity.ToTable("services");
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Id).HasColumnName("id");
                entity.Property(e => e.ServiceName).HasColumnName("service_name").IsRequired();
                entity.Property(e => e.BasePrice).HasColumnName("base_price").HasDefaultValue(0);
            });

            // EventFinances
            modelBuilder.Entity<EventFinance>(entity =>
            {
                entity.ToTable("event_finances");
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Id).HasColumnName("id");
                entity.Property(e => e.EventId).HasColumnName("event_id");
                entity.Property(e => e.ServiceId).HasColumnName("service_id");
                entity.Property(e => e.EstimatedAmount).HasColumnName("estimated_amount").HasDefaultValue(0);
                entity.Property(e => e.EstimatedNote).HasColumnName("estimated_note");
                entity.Property(e => e.ExtraAmount).HasColumnName("extra_amount").HasDefaultValue(0);
                entity.Property(e => e.ExtraNote).HasColumnName("extra_note");
                entity.Ignore(e => e.TotalAmount);

                entity.HasOne(e => e.Event)
                    .WithMany(e => e.EventFinances)
                    .HasForeignKey(e => e.EventId)
                    .OnDelete(DeleteBehavior.Cascade);

                entity.HasOne(e => e.Service)
                    .WithMany(s => s.EventFinances)
                    .HasForeignKey(e => e.ServiceId)
                    .OnDelete(DeleteBehavior.SetNull);
            });

            // Profiles
            modelBuilder.Entity<Profile>(entity =>
            {
                entity.ToTable("profiles");
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Id).HasColumnName("id");
                entity.Property(e => e.Email).HasColumnName("email");
                entity.Property(e => e.FullName).HasColumnName("full_name");
                entity.Property(e => e.Role).HasColumnName("role").HasDefaultValue("staff");
                entity.Property(e => e.CreatedAt).HasColumnName("created_at").HasDefaultValueSql("now()");
            });
        }
    }
}
```

---

## PH·∫¶N 5: C·∫§U H√åNH CONNECTION STRING

### B∆∞·ªõc 5.1: L·∫•y Connection String t·ª´ Supabase

1. V√†o **Supabase Dashboard**
2. Ch·ªçn project c·ªßa b·∫°n
3. **Settings ‚Üí Database**
4. Scroll xu·ªëng **Connection string**
5. Ch·ªçn tab **URI** ho·∫∑c **Connection pooling**
6. Copy connection string

V√≠ d·ª•:
```
postgresql://postgres:[YOUR-PASSWORD]@db.xxxxx.supabase.co:5432/postgres
```

### B∆∞·ªõc 5.2: C·∫•u h√¨nh appsettings.json

1. Trong **EventManager.API**, m·ªü file `appsettings.json`
2. Thay th·∫ø to√†n b·ªô n·ªôi dung b·∫±ng:

```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Host=db.xxxxx.supabase.co;Database=postgres;Username=postgres;Password=YOUR_PASSWORD;Port=5432"
  },
  "Jwt": {
    "Key": "YOUR_SECRET_KEY_MINIMUM_32_CHARACTERS_LONG_FOR_SECURITY",
    "Issuer": "EventManagerAPI",
    "Audience": "EventManagerClient",
    "ExpiryInMinutes": 60
  },
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "AllowedHosts": "*"
}
```

> [!WARNING]
> **Thay th·∫ø:**
> - `db.xxxxx.supabase.co` ‚Üí Host t·ª´ Supabase
> - `YOUR_PASSWORD` ‚Üí Password database c·ªßa b·∫°n
> - `YOUR_SECRET_KEY...` ‚Üí M·ªôt chu·ªói b√≠ m·∫≠t d√†i √≠t nh·∫•t 32 k√Ω t·ª±

---

## PH·∫¶N 6: T·∫†O JWT SERVICE

### B∆∞·ªõc 6.1: T·∫°o th∆∞ m·ª•c Services trong Infrastructure

1. Right-click **EventManager.Infrastructure**
2. **Add ‚Üí New Folder**
3. T√™n: `Services`

### B∆∞·ªõc 6.2: T·∫°o JwtService.cs

1. Right-click folder **Services** ‚Üí **Add ‚Üí Class**
2. T√™n: `JwtService.cs`
3. Paste code:

```csharp
using System;
using System.IdentityModel.Tokens.Jwt;
using System.Security.Claims;
using System.Text;
using Microsoft.Extensions.Configuration;
using Microsoft.IdentityModel.Tokens;

namespace EventManager.Infrastructure.Services
{
    public interface IJwtService
    {
        string GenerateToken(string userId, string email, string role);
    }

    public class JwtService : IJwtService
    {
        private readonly IConfiguration _configuration;

        public JwtService(IConfiguration configuration)
        {
            _configuration = configuration;
        }

        public string GenerateToken(string userId, string email, string role)
        {
            var key = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(_configuration["Jwt:Key"]!));
            var credentials = new SigningCredentials(key, SecurityAlgorithms.HmacSha256);

            var claims = new[]
            {
                new Claim(JwtRegisteredClaimNames.Sub, userId),
                new Claim(JwtRegisteredClaimNames.Email, email),
                new Claim(ClaimTypes.Role, role),
                new Claim(JwtRegisteredClaimNames.Jti, Guid.NewGuid().ToString())
            };

            var token = new JwtSecurityToken(
                issuer: _configuration["Jwt:Issuer"],
                audience: _configuration["Jwt:Audience"],
                claims: claims,
                expires: DateTime.UtcNow.AddMinutes(Convert.ToDouble(_configuration["Jwt:ExpiryInMinutes"])),
                signingCredentials: credentials
            );

            return new JwtSecurityTokenHandler().WriteToken(token);
        }
    }
}
```

---

## PH·∫¶N 7: T·∫†O CONTROLLERS

### B∆∞·ªõc 7.1: T·∫°o th∆∞ m·ª•c Controllers (n·∫øu ch∆∞a c√≥)

1. Right-click **EventManager.API**
2. **Add ‚Üí New Folder**
3. T√™n: `Controllers`

### B∆∞·ªõc 7.2: T·∫°o EventsController.cs

1. Right-click folder **Controllers** ‚Üí **Add ‚Üí Controller**
2. Ch·ªçn **API Controller - Empty**
3. T√™n: `EventsController`
4. Paste code:

```csharp
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using EventManager.Domain.Entities;
using EventManager.Infrastructure.Data;

namespace EventManager.API.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    [Authorize]
    public class EventsController : ControllerBase
    {
        private readonly ApplicationDbContext _context;

        public EventsController(ApplicationDbContext context)
        {
            _context = context;
        }

        [HttpGet]
        public async Task<ActionResult<IEnumerable<Event>>> GetEvents()
        {
            return await _context.Events
                .Include(e => e.EventTasks)
                .Include(e => e.EventFinances)
                .ToListAsync();
        }

        [HttpGet("{id}")]
        public async Task<ActionResult<Event>> GetEvent(Guid id)
        {
            var eventItem = await _context.Events
                .Include(e => e.EventTasks)
                    .ThenInclude(t => t.Staff)
                .Include(e => e.EventTasks)
                    .ThenInclude(t => t.Task)
                .Include(e => e.EventFinances)
                    .ThenInclude(f => f.Service)
                .FirstOrDefaultAsync(e => e.Id == id);

            if (eventItem == null)
                return NotFound();

            return eventItem;
        }

        [HttpPost]
        public async Task<ActionResult<Event>> CreateEvent(Event eventItem)
        {
            eventItem.Id = Guid.NewGuid();
            eventItem.CreatedAt = DateTime.UtcNow;

            _context.Events.Add(eventItem);
            await _context.SaveChangesAsync();

            return CreatedAtAction(nameof(GetEvent), new { id = eventItem.Id }, eventItem);
        }

        [HttpPut("{id}")]
        public async Task<IActionResult> UpdateEvent(Guid id, Event eventItem)
        {
            if (id != eventItem.Id)
                return BadRequest();

            _context.Entry(eventItem).State = EntityState.Modified;
            await _context.SaveChangesAsync();

            return NoContent();
        }

        [HttpDelete("{id}")]
        [Authorize(Roles = "superadmin")]
        public async Task<IActionResult> DeleteEvent(Guid id)
        {
            var eventItem = await _context.Events.FindAsync(id);
            if (eventItem == null)
                return NotFound();

            _context.Events.Remove(eventItem);
            await _context.SaveChangesAsync();

            return NoContent();
        }
    }
}
```

### B∆∞·ªõc 7.3: T·∫°o StaffController.cs

T∆∞∆°ng t·ª±, t·∫°o file `StaffController.cs`:

```csharp
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using EventManager.Domain.Entities;
using EventManager.Infrastructure.Data;

namespace EventManager.API.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    [Authorize]
    public class StaffController : ControllerBase
    {
        private readonly ApplicationDbContext _context;

        public StaffController(ApplicationDbContext context)
        {
            _context = context;
        }

        [HttpGet]
        public async Task<ActionResult<IEnumerable<Staff>>> GetStaff()
        {
            return await _context.Staff.ToListAsync();
        }

        [HttpGet("{id}")]
        public async Task<ActionResult<Staff>> GetStaffMember(Guid id)
        {
            var staff = await _context.Staff.FindAsync(id);
            if (staff == null)
                return NotFound();

            return staff;
        }

        [HttpPost]
        [Authorize(Roles = "superadmin")]
        public async Task<ActionResult<Staff>> CreateStaff(Staff staff)
        {
            staff.Id = Guid.NewGuid();
            _context.Staff.Add(staff);
            await _context.SaveChangesAsync();

            return CreatedAtAction(nameof(GetStaffMember), new { id = staff.Id }, staff);
        }

        [HttpPut("{id}")]
        [Authorize(Roles = "superadmin")]
        public async Task<IActionResult> UpdateStaff(Guid id, Staff staff)
        {
            if (id != staff.Id)
                return BadRequest();

            _context.Entry(staff).State = EntityState.Modified;
            await _context.SaveChangesAsync();

            return NoContent();
        }

        [HttpDelete("{id}")]
        [Authorize(Roles = "superadmin")]
        public async Task<IActionResult> DeleteStaff(Guid id)
        {
            var staff = await _context.Staff.FindAsync(id);
            if (staff == null)
                return NotFound();

            _context.Staff.Remove(staff);
            await _context.SaveChangesAsync();

            return NoContent();
        }
    }
}
```

> [!NOTE]
> B·∫°n c√≥ th·ªÉ t·∫°o th√™m c√°c controllers t∆∞∆°ng t·ª± cho: TaskTemplates, EventTasks, Services, EventFinances

---

## PH·∫¶N 8: C·∫§U H√åNH PROGRAM.CS

### B∆∞·ªõc 8.1: M·ªü Program.cs

1. Trong **EventManager.API**, double-click `Program.cs`
2. Thay th·∫ø to√†n b·ªô n·ªôi dung b·∫±ng:

```csharp
using Microsoft.EntityFrameworkCore;
using Microsoft.AspNetCore.Authentication.JwtBearer;
using Microsoft.IdentityModel.Tokens;
using System.Text;
using EventManager.Infrastructure.Data;
using EventManager.Infrastructure.Services;

var builder = WebApplication.CreateBuilder(args);

// Add services to the container
builder.Services.AddControllers();
builder.Services.AddEndpointsApiExplorer();
builder.Services.AddSwaggerGen();

// Database
builder.Services.AddDbContext<ApplicationDbContext>(options =>
    options.UseNpgsql(builder.Configuration.GetConnectionString("DefaultConnection")));

// JWT Service
builder.Services.AddScoped<IJwtService, JwtService>();

// Authentication
builder.Services.AddAuthentication(options =>
{
    options.DefaultAuthenticateScheme = JwtBearerDefaults.AuthenticationScheme;
    options.DefaultChallengeScheme = JwtBearerDefaults.AuthenticationScheme;
})
.AddJwtBearer(options =>
{
    options.TokenValidationParameters = new TokenValidationParameters
    {
        ValidateIssuer = true,
        ValidateAudience = true,
        ValidateLifetime = true,
        ValidateIssuerSigningKey = true,
        ValidIssuer = builder.Configuration["Jwt:Issuer"],
        ValidAudience = builder.Configuration["Jwt:Audience"],
        IssuerSigningKey = new SymmetricSecurityKey(
            Encoding.UTF8.GetBytes(builder.Configuration["Jwt:Key"]!))
    };
});

builder.Services.AddAuthorization();

// CORS
builder.Services.AddCors(options =>
{
    options.AddPolicy("AllowAll", policy =>
    {
        policy.AllowAnyOrigin()
              .AllowAnyMethod()
              .AllowAnyHeader();
    });
});

var app = builder.Build();

// Configure the HTTP request pipeline
if (app.Environment.IsDevelopment())
{
    app.UseSwagger();
    app.UseSwaggerUI();
}

app.UseHttpsRedirection();
app.UseCors("AllowAll");
app.UseAuthentication();
app.UseAuthorization();
app.MapControllers();

app.Run();
```

---

## PH·∫¶N 9: CH·∫†Y V√Ä TEST

### B∆∞·ªõc 9.1: Build Solution

1. **Build ‚Üí Build Solution** (Ctrl+Shift+B)
2. Ki·ªÉm tra **Output** window, ƒë·∫£m b·∫£o kh√¥ng c√≥ l·ªói

### B∆∞·ªõc 9.2: Ch·∫°y ·ª©ng d·ª•ng

1. Click n√∫t **‚ñ∂ Play** (ho·∫∑c F5)
2. Tr√¨nh duy·ªát s·∫Ω m·ªü t·ª± ƒë·ªông v·ªõi Swagger UI
3. URL: `https://localhost:7xxx/swagger`

### B∆∞·ªõc 9.3: Test API v·ªõi Swagger

1. M·ªü r·ªông endpoint **GET /api/Events**
2. Click **Try it out**
3. Click **Execute**

> [!WARNING]
> B·∫°n s·∫Ω nh·∫≠n l·ªói **401 Unauthorized** v√¨ ch∆∞a c√≥ token. ƒê√¢y l√† ƒëi·ªÅu b√¨nh th∆∞·ªùng!

---

## PH·∫¶N 10: B∆Ø·ªöC TI·∫æP THEO

### ‚úÖ ƒê√£ ho√†n th√†nh:
- T·∫°o solution v·ªõi Clean Architecture
- C·∫•u h√¨nh Entity Framework Core v·ªõi PostgreSQL
- T·∫°o 7 Entity Models
- Thi·∫øt l·∫≠p JWT Authentication
- T·∫°o 2 Controllers c∆° b·∫£n (Events, Staff)

### üîÑ C·∫ßn l√†m ti·∫øp:
1. **T·∫°o AuthController** ƒë·ªÉ login/register
2. **T·∫°o c√°c Controllers c√≤n l·∫°i** (TaskTemplates, EventTasks, Services, EventFinances)
3. **T·∫°o Business Services** (FinanceService, FileUploadService)
4. **Th√™m SignalR Hub** cho real-time updates
5. **Test v·ªõi frontend React**

---

## üìö T√≥m t·∫Øt c·∫•u tr√∫c files

```
EventManager.Domain/
‚îî‚îÄ‚îÄ Entities/
    ‚îú‚îÄ‚îÄ Event.cs
    ‚îú‚îÄ‚îÄ Staff.cs
    ‚îú‚îÄ‚îÄ TaskTemplate.cs
    ‚îú‚îÄ‚îÄ EventTask.cs
    ‚îú‚îÄ‚îÄ Service.cs
    ‚îú‚îÄ‚îÄ EventFinance.cs
    ‚îî‚îÄ‚îÄ Profile.cs

EventManager.Infrastructure/
‚îú‚îÄ‚îÄ Data/
‚îÇ   ‚îî‚îÄ‚îÄ ApplicationDbContext.cs
‚îî‚îÄ‚îÄ Services/
    ‚îî‚îÄ‚îÄ JwtService.cs

EventManager.API/
‚îú‚îÄ‚îÄ Controllers/
‚îÇ   ‚îú‚îÄ‚îÄ EventsController.cs
‚îÇ   ‚îî‚îÄ‚îÄ StaffController.cs
‚îú‚îÄ‚îÄ appsettings.json
‚îî‚îÄ‚îÄ Program.cs
```

---

## ‚ùì C√¢u h·ªèi th∆∞·ªùng g·∫∑p

**Q: T√¥i g·∫∑p l·ªói "Unable to resolve service for type ApplicationDbContext"?**
A: ƒê·∫£m b·∫£o b·∫°n ƒë√£ th√™m `builder.Services.AddDbContext<ApplicationDbContext>` trong Program.cs

**Q: Connection string kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c?**
A: Ki·ªÉm tra l·∫°i Host, Password t·ª´ Supabase. Th·ª≠ test connection b·∫±ng pgAdmin ho·∫∑c DBeaver

**Q: L√†m sao ƒë·ªÉ test API khi ch∆∞a c√≥ login?**
A: T·∫°m th·ªùi b·ªè `[Authorize]` attribute trong controller ƒë·ªÉ test, sau ƒë√≥ th√™m l·∫°i

---

> [!IMPORTANT]
> N·∫øu b·∫°n g·∫∑p b·∫•t k·ª≥ l·ªói n√†o, h√£y copy th√¥ng b√°o l·ªói ƒë·∫ßy ƒë·ªß v√† cho t√¥i bi·∫øt. T√¥i s·∫Ω gi√∫p b·∫°n gi·∫£i quy·∫øt ngay!
